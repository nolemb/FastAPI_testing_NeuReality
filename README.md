# FastAPI Test Framework - NeuReality Home Assignment

This project provides a FastAPI application with APIs for string reversing and last response restore.
The application is Dockerized for easy deployment and includes a testing framework written with pytest.
---

## Table of Contents

- [Overview](#Overview)
- [Features](#Features)
- [Testing Framework](#Testing-Framework)
- [Prerequisites](#Prerequisites)
- [Setup Instructions](#Setup-Instructions)
- [Successful Test Results](#Successful-Test-Results)
- [Contributing](#Contributing)
- [Explanation of Files](#Explanation-of-Files)

---

## Overview

The application provides two APIs:

Reverse String API (/reverse): This API takes a string as input via the in query parameter and returns a JSON response
with a field named result containing the reversed string.
Restore Last Result API (/restore): This API returns the last result from the Reverse String API.
---

## Features

- `/reverse`: Reverse the words in a given string.
- `/restore`: Retrieve the last result from any API.
- Pytest-based test framework that starts the application container, runs the tests, and cleans up.

---

## Testing Framework

The included testing framework uses pytest to ensure the APIs function as expected.

The tests perform the following:

- Start the Docker container containing the application
- Run tests to verify API functionality
- Stop the Docker container
- Generate a JUnit report of the test results

The framework is designed to allow developers to easily add new API tests.

---

## Prerequisites

1. Install **Docker**  on your system.
2. Install Python 3.9 or higher.

---

## Setup Instructions

### Step 1: Clone the Repository

```bash
git clone https://github.com/nolemb/FastAPI_testing_NeuReality
cd FastAPI_testing_NeuReality/app/tests/
```

### Step 2: Run the Tests

```bash
pytest --junitxml=test-results.xml --tb=short
```

This command:

- Starts the FastAPI app container.
- Runs all tests in test_api.py.
- Generates a JUnit XML test report (test-results.xml).

#### NOTE: test_api.py handles  the creation of image and the container run

---

## Successful Test Results

A successful test run will execute all test cases without errors and display a message indicating that all tests passed.
The JUnit report generated by the tests will also show all tests passed with details about each test execution.

---

## Contributing

Developers can contribute to this project by adding new tests and API calls.

### To add new API tests, follow these steps:

- Create a new test file in the test_api directory.
- Define test functions using the pytest framework.
- Use the httpx library to send API requests.
- Assert the expected behavior of the API.
- Ensure the tests cover the desired functionality of the new API.

```python
def test_new_api():
    response = httpx.get(f"{BASE_URL}/new_endpoint")
    assert response.status_code == 200
    assert response.json() == {"key": "value"}
```

### To add new API calls, follow these steps:

- Use FastAPI using decorator `@app`.
- Use `app.get/put/post/delete` or other API calls if implemented.
- Add `response_model=GenericResponse` as the response model of app.
- Implement API call.
- Set API response to ```response = GenericResponse(data=`new_api_response`)```, new_api_response is the response from
  the API call you implemented.

```python
@app.get("/reverse", response_model=GenericResponse)
def reverse_string(user_input: Annotated[str, Query(alias="in")]):
    reversed_input = " ".join(user_input.split()[::-1])
    response = GenericResponse(data={"result": reversed_input})
    set_last_response(response)  # Store the last response
    return response
```

---

## Explanation of Files

- Dockerfile: Builds the FastAPI app container.
- app: Directory containing the FastAPI app code.
- test_api.py: Pytest-based test framework for API testing.
- requirements.txt: Python dependencies for both the app and tests.
- README.md: This file, providing documentation.